Переименование файлов с использованием регулярных выражений или перенумерация файлов.
(C) Smitis, 2010-2024
XRENN = 
    X - Регулярные выражения (regeXp)
    REN - REName / RENumber
    N - Names only
Дополнительно, программа может копировать, перемещать и удалять файлы, имена которых сопоставляются с регулярным выражением.

Программа изменяет только имена файлов, расширения не затрагиваются. Для папок считается, что у них расширений нет. Имена вида ".qwerty", т.е. начинающиеся с едиственной точки, считаются состоящими из одного имени без расширения. Скрытые и системные файлы по умолчанию пропускаются. Если обработка описаний не отключена, файл descript.ion тоже пропускается. Для включения расширений в обработку можно использовать ключ /EXT.

Параметры задаются в стиле WSH, т.е. могут быть именованные и неименованные. Именованные имеют вид /ключ или /ключ:значение, в дальнейшем просто ключ. Все остальные - неименованные, в дальнейшем просто параметры. Это сделано для совместимости со скриптом vrenn.vbs. В отличие от WSH, вместо двоеточия можно использовать символ равенства, а для ключей /N, /A, /I (использующих числовое значение) разделитель можно опускать, например: /N100 /A3 /I1. Параметры регистронезависимы.

Для контроля процесса, на экран выводятся имена обрабатываемых файлов, в конце выводится статистика.

При переименовании и перенумерации создаются файлы отката, позволяющие вернуть предыдущие имена файлов. Файлы отката создаются по умолчанию во временной папке и имеют имена вида YYYY-MM-DD--hh-mm-ss--nnnnnnnnnnnnnnnnnnnn.xrenn - дата и время начала операции и счётчик для гарантии уникальности файла. При использовании ключа /UCD файлы отката будут создаваться в текущей папке и им будет установлен атрибут "скрытый". Файлы отката создаются в кодировке UTF-8 без BOM. Для отката может использоваться XRENN с ключом /U (см. далее). Кроме того, сами файлы отката имеют структуру командного файла, поэтому для отката можно изменить расширение на cmd или bat и запустить, однако, в этом случае не будут восстановлены описания файлов. Как вариант, в переименованном файле отката можно раскоментировать строку с :@XRENN.EXE (убрав двоеточие) и запустить этот файл. После отката через XRENN, файл отката будет переименован, к расширению будет добавлено -bak. Это необходимо для корректной работы нескольких последовательных откатов командами /U.

Для дополнительной фильтрации возможно задавать маски файлов в "классическом" виде с использованием * и ?. Маска может состоять из нескольких подмасок, перечисленных через точку с запятой, например "*.jpg;*.jpeg;*.png;*.gif". Маска как правило задаётся первым параметром и имеет меньший приоритет, по сравнению с другими параметрами, например, единственный параметр для /D будет рассматриваться как шаблон, а два параметра как маска и шаблон. Альтернативным способом является задание маски в виде ключа /mask. Такая маска должна иметь хотя бы один символ * или ?, чтобы её можно было отличить от остальных ключей. Если задано несколько масок параметрами и ключами, все они будут обработаны, например в "XRENN *.jpg;*.jpeg /*.bmp /*.gif;*.png . /D" будет использоваться маска "*.bmp;*.gif;*.png;*.jpg;*.jpeg". Если маска не задана, по умолчанию используется "*.*". Если задан список, все маски игнорируется.

Обрабатываемые файлы могут быть заданы списком через файл, указаный в ключе /L. Структура списка - одна строка - одно имя файла. Список файлов должен быть в локальной кодировке для неюникодных программ (для русской локали CP-1251) или unicode (UCS2, UTF-8) с BOM. Маски и пути в списке не допускаются.

Если задан список, файлы обрабатываются в порядке по списку. Иначе, файлы обрабатываются в алфавитном порядке.

При переименовании от имени отбрасываются начальные и конечные пробелы и конечные точки.

Программа обрабатывает описания файлов, находящиеся в файле descript.ion и модифицирует его при необходимости. Файл описаний должен быть в кодировке, которая установлена для неюникодных приложений или unicode (UCS2, UTF-8) с BOM.

Файлы обрабатываются только в текущей папке, обхода дерева папок нет.

Обратные ссылки в строке замены могут быть от \0 до \9.

Основные функции:

* Переименование.
XRENN [mask] pattern replace|\ /N[N][:start]|/N[N][:+|-add] [/NA:width] [/STEP:step]
Символ \ в качестве строки замены означает пустую строку "" (т.е., удаление найденых по шаблону совпадений). Это для сокращения записи (символ \ всё равно не допустим в именах файлов).
Все замены - глобальные, заменяются все возможные совпадения.
В строке замены можно использовать \N или \n для вставки текущего номера. Начальное значение номера задаётся ключом /NN, выравнивание ключом /NA, шаг ключом /STEP. Более подробно про нумерацию описано в описании перенумерации.

* Добавление символов в начало имени (префикс) или конец (суффикс)
XRENN [[mask] pattern] /PF:text|/SF:text /N[N][:start]|/N[N][:+|-add] [/NA:width] [/STEP:step]
К имени добавляется произвольный текст в начало (prefix - /PF) или в конец (suffix - /SF).
В добавляемом тексте можно использовать \N или \n для вставки номера аналогично переименованию.

* Перенумерация.
XRENN [[mask] pattern] /N[N][:start] [/A:width] [/STEP:step] [/I:index]
В имени файла файла ищется и заменяется число на значение счётчика. Начальное значение счётчика задаётся ключом /N или /NN. По умолчанию начальное значение 1. Приращение счётчика задаётся ключом /STEP. По умолчанию приращение 1. Приращение может быть отрицательным, начальное значение нет.
Если очередной номер получается отрицательным, то подставляется его абсолютное значение.
Если в имени несколько чисел, задать порядковый номер (индекс) числа можно ключом /I. Отрицательный индекс означает отсчёт с конца имени. По умолчанию индекс -1 (последнее число).
При к использовании ключа /N файлы сортируются по алфавиту.
При использовании ключа /NN файлы сортируются по числовому значению. При этом, если приращение шага положительное, сортировка осуществляется в обратном порядке, это позволяет правильно перенумеровывать файла исключая конфликты имён.

Числа могут выравниваться до нужной длины дополненние слева незначащими нулями.
Если используется ключ /A, для выравнивания будет использованно заданое в ключе значение. При width=0, выравнивание производится не будет, незначащие нули слева будут отброшены. При width>0, выравнивание будет происходить дополнением нулями слева без потери значащих цифр. При width<0, число будет выравниваться или усекаться до Abs(width).
Если ключ /A не задан и значение start имеет слева незначащие нули, для выравнивания будет взято количество символов задающих значение start. Например, /N:00100 начнёт отсчёт со 100 с дополнением слева нулями до 5 знаков. При выравнивании исключается потеря значащих цифр, т.е. слишком длинное число усекаться не будет.
Если предыдущие условия не выполняются, будет подсчитано количество файлов, попадающих под условия обработки и вычислен максимальный возможный номер числа. Количество цифр в этом числе будет использовано для выравнивания.

Если не задан шаблон, по умолчанию будет использован шаблон \d (файлы, содержащие хотя бы одну цифру в имени).

* Выравнивание чисел.
XRENN [[mask] pattern] /A:width [/I:index]
Аналогично перенумерации с ключом /A, но без изменения значения самого числа, только выравнивание.

* Изменение нумерации.
XRENN [[mask] pattern] /N:+disp|/N:-disp [/A:width] [/STEP:step] [/I:index]
Число в имени изменяется на значение disp. Значение disp всегда задаётся со знаком (чтобы отличить от перенумерации). Всё остальное аналогично перенумерации.

* Копирование (/C) или перемещение (/M) в заданую папку.
XRENN [mask] pattern /C:folder|/M:folder
Копируются или перемещаются только файлы, ключи /F и /FF игнорируются.
При необходимости, папка назначения будет создана.

* Удаление (/D) или удаление в корзину (/DR).
XRENN [mask] pattern] /D|/DR
Удаляются только файлы, ключи /F и /FF игнорируются.

* Откат переименования
XRENN /U:undofile

* Откат последнего переименования для текущей папки
XRENN /U
Будут просматриваться файлы xrenn в текущей и во временной папке. Взят будет последний файл отката, имеющий ссылку @CHDIR на текущую папку. Так как после выполнения отката файл отката переименовывается, команда /U позволяет произвести несколько последних откатов подряд.

Общие ключи. Могут использоваться с любой функцией. Для функций отката смысла не имеют.
/mask - Альтернативный способ задать маску. Маска должна содержать хотя бы один символ * или ?.
/L:filelist - файл, содержащий список обрабатываемых файлов.
/Q - Не выводить результаты работы и сообщения на экран, пауза в конце не делается.
/Q1 - Все результаты, ошибки и статистика выводится на экран. Пауза в конце не делается.
/Q2 - Выводится только статистика. Пауза не делается.
/CS - Case Sensitive - Учитывать регистр в регулярном выражении.
/ - Пустой параметр / означает поиск с начала имени - в начало шаблона будет добавлен символ ^, если его там нет. Этот ключ позволяет упростить запись шаблона (не использовать кавычки), так как символ ^ имеет статус esc-символа для командной строки. 
/H - Обрабатывать скрытые и системные файлы.
/Z- - Не обрабатывать описания.
/U- - Не создавать файл отката.
/UCD - Создавать скрытый файл отката в текущей папке.
/EXT - Обрабатывать расширения файлов. По умолчанию, расширения не обрабатываются и сохраняются неизменными.

Коды возврата
0 - Нет ошибок
1 - Ошибка в параметрах.
2 - Ошибка в регулярном выражении.
3 - Ошибка открытия файла списка или файла отката.
4 - Ошибка изменения папки.
5 - Ошибка переименования.
6 - Ошибка обработки файла описаний.
7 - Ошибки отката.

Некоторые ключи имеют короткую и полную запись (синонимы):
/C - /COPY
/M - /MOVE
/DR - /RECYCLE
/D - /DELETE
/N - /RENUM
/A - /ALIGN
/I - /INDEX
/U - /UNDO
/U+ - /UNDO+
/UCD - /UNDOCD
/SF - /SUFFIX
/PF - /PREFIX
/L - /LIST
/T - /TEST
При использовании синонимов разделительные знаки ":" и "=" опускать нельзя.
